# Minikube-specific values for Appointments App

# Global settings
global:
  environment: Development
  namespace: appointments-app
  imagePullPolicy: Never  # Use local images built in Minikube (required after running build-and-load-images.sh)

# Chart settings
fullnameOverride: "appointments-app"
nameOverride: ""

# Service Account
serviceAccount:
  create: false
  name: ""

# Secrets configuration
secrets:
  # JWT Secret Key (base64 encoded)
  # Original: 3db7680a09d57e354d9513e60a6fbe793768cfeed510e8a92feec809a3e3215c
  jwtSecretKey: "M2RiNzY4MGEwOWQ1N2UzNTRkOTUxM2U2MGE2ZmJlNzkzNzY4Y2ZlZWQ1MTBlOGE5MmZlZWM4MDlhM2UzMjE1Yw=="
  # Vatcheck API Key (base64 encoded)
  # Original: vat_live_0Jx7jKQgN04C2O9dbZe58LyhXTEtJJ6xL9pqwjGP
  vatcheckApiKey: "dmF0X2xpdmVfMEp4N2pLUWdOMDRDMk85ZGJaZTU4THloWFRFdEpKNnhMOXBxd2pHUA=="

# PostgreSQL
postgresql:
  enabled: true
  image:
    repository: postgres
    tag: "16"
  port: 5432
  admin:
    username: postgres
    password: "adminpassword"
  storage:
    size: 2Gi  # Reduced size for Minikube
    storageClass: "standard"  # Minikube's default storage class
    accessMode: ReadWriteOnce
  resources:
    requests:
      memory: "256Mi"  # Reduced memory for Minikube
      cpu: "250m"
    limits:
      memory: "512Mi"  # Reduced memory for Minikube
      cpu: "500m"
  config:
    maxConnections: 100  # Reduced for Minikube
    sharedBuffers: 128MB
    effectiveCacheSize: 256MB
  init:
    enabled: false  # Enable database initialization - create only databases and users

# Kafka configuration
kafka:
  bootstrapServers: "kafka.kafka:9092"
  topics:
    userEvents: "user-events"
    tenantEvents: "tenant-events"
  producers:
    acks: "all"
    enableIdempotence: "true"
    messageTimeoutMs: "5000"
    requestTimeoutMs: "3000"
  consumers:
    enableAutoCommit: "false"
    autoOffsetReset: "earliest"

# Services configuration - optimized for Minikube
services:
  user:
    enabled: true
    image: user-service:latest
    replicas: 2
    port: 8000
    database:
      name: userdb
      user: userdb_user
      password: userdb_password
    resources:
      requests:
        memory: "128Mi"
        cpu: "100m"
      limits:
        memory: "256Mi"
        cpu: "250m"
    health:
      livenessPath: /health/live
      readinessPath: /health/ready
    migration:
      image: user-database-migrator:latest
      enabled: true

  serviceCatalog:
    enabled: true
    image: service-catalog-service:latest
    replicas: 2 
    port: 8000
    database:
      name: servicedb
      user: servicedb_user
      password: servicedb_password
    resources:
      requests:
        memory: "128Mi"
        cpu: "100m"
      limits:
        memory: "256Mi"
        cpu: "250m"
    health:
      livenessPath: /health/live
      readinessPath: /health/ready
    migration:
      image: service-catalog-database-migrator:latest
      enabled: true

  availability:
    enabled: true
    image: availability-service:latest
    replicas: 2
    port: 8000
    database:
      name: availabilitydb
      user: availabilitydb_user
      password: availabilitydb_password
    resources:
      requests:
        memory: "128Mi"
        cpu: "100m"
      limits:
        memory: "256Mi"
        cpu: "250m"
    health:
      livenessPath: /health/live
      readinessPath: /health/ready
    migration:
      image: availability-database-migrator:latest
      enabled: true

  booking:
    enabled: true
    image: booking-service:latest
    replicas: 2
    port: 8000
    database:
      name: bookingdb
      user: bookingdb_user
      password: bookingdb_password
    resources:
      requests:
        memory: "128Mi"
        cpu: "100m"
      limits:
        memory: "256Mi"
        cpu: "250m"
    health:
      livenessPath: /health/live
      readinessPath: /health/ready
    migration:
      image: booking-database-migrator:latest
      enabled: true

  notification:
    enabled: true
    image: notification-service:latest
    replicas: 2
    port: 8000
    database:
      name: notificationdb
      user: notificationdb_user
      password: notificationdb_password
    resources:
      requests:
        memory: "128Mi"
        cpu: "100m"
      limits:
        memory: "256Mi"
        cpu: "250m"
    health:
      livenessPath: /health/live
      readinessPath: /health/ready
    migration:
      image: notification-database-migrator:latest
      enabled: true

# Ingress configuration for Minikube
ingress:
  enabled: true
  className: nginx
  host: ""  # Leave empty to use Minikube IP directly
  paths:
    auth: /api/auth
    users: /api/users
    tenants: /api/tenants
    services: /api/services
    categories: /api/categories
    availability: /api/availability
    bookings: /api/bookings

# Migrations
migrations:
  enabled: true
  targetMigration: ""  # Empty means latest
  jobTtlSecondsAfterFinished: 300  # 5 minutes

# Service discovery
service:
  type: ClusterIP

# Common health probe settings - adjusted for Minikube
healthProbes:
  liveness:
    initialDelaySeconds: 20  # Reduced for faster startup
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3
  readiness:
    initialDelaySeconds: 5
    periodSeconds: 5
    timeoutSeconds: 3
    failureThreshold: 3
  startup:
    initialDelaySeconds: 0
    periodSeconds: 5
    timeoutSeconds: 5
    failureThreshold: 20  # Reduced for Minikube